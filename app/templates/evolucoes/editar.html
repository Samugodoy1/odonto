{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('listar_pacientes') }}">Pacientes</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('detalhe_paciente', paciente_id=paciente.id) }}">{{ paciente.nome }}</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('listar_evolucoes', paciente_id=paciente.id) }}">Evolução</a></li>
                <li class="breadcrumb-item active" aria-current="page">Editar</li>
            </ol>
        </nav>
        <h1 class="h2">
            <i class="bi bi-pencil-square"></i> Editar Evolução
        </h1>
        <p class="text-muted">Paciente: {{ paciente.nome }}</p>
    </div>
    <a href="{{ url_for('listar_evolucoes', paciente_id=paciente.id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Voltar
    </a>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <form method="POST" action="{{ url_for('editar_evolucao', evolucao_id=evolucao.id) }}">
            {{ form.hidden_tag() }}
            {{ form.paciente_id(value=paciente.id) }}
            
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="data" class="form-label">Data*</label>
                    {{ form.data(class="form-control " + ("is-invalid" if form.data.errors else ""), id="data", type="date") }}
                    {% if form.data.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.data.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="col-md-8">
                    <label for="procedimento" class="form-label">Procedimento*</label>
                    {{ form.procedimento(class="form-control " + ("is-invalid" if form.procedimento.errors else ""), id="procedimento") }}
                    {% if form.procedimento.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.procedimento.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="col-md-12">
                    <label for="supervisor" class="form-label">Dentista/Supervisor</label>
                    {{ form.supervisor(class="form-control " + ("is-invalid" if form.supervisor.errors else ""), id="supervisor") }}
                    {% if form.supervisor.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.supervisor.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="col-md-12">
                    <label for="observacao" class="form-label">Observação</label>
                    {{ form.observacao(class="form-control " + ("is-invalid" if form.observacao.errors else ""), id="observacao", rows=2) }}
                    {% if form.observacao.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.observacao.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="col-md-12">
                    <label for="detalhes" class="form-label">Detalhes do Procedimento</label>
                    {{ form.detalhes(class="form-control " + ("is-invalid" if form.detalhes.errors else ""), id="detalhes", rows=5) }}
                    {% if form.detalhes.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.detalhes.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div class="form-text">Descreva em detalhes o procedimento realizado, materiais utilizados, etc.</div>
                </div>
                
                <div class="col-12 mt-3">
                    <div class="d-flex justify-content-end">
                        <a href="{{ url_for('listar_evolucoes', paciente_id=paciente.id) }}" class="btn btn-outline-secondary me-2">Cancelar</a>
                        {{ form.submit(class="btn btn-primary") }}
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}
